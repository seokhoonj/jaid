% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/sampling.R
\name{stratified_sampling}
\alias{stratified_sampling}
\title{Stratified sampling (by data.table groups)}
\usage{
stratified_sampling(
  df,
  group_var,
  size,
  replace = TRUE,
  contain0 = FALSE,
  method = c("round", "floor", "ceiling"),
  verbose = TRUE,
  seed = 123
)
}
\arguments{
\item{df}{A data.table.}

\item{group_var}{Grouping columns. Supply bare names in a tidy style,
e.g. \code{.(Species)} or \code{.(g1, g2)}.}

\item{size}{A positive number controlling per-group sample size:
a proportion if \verb{0 < size < 1}, otherwise an absolute count
(same for all groups).}

\item{replace}{Logical; sample with replacement? Default \code{TRUE}.}

\item{contain0}{Logical; if \code{TRUE}, groups with computed target 0 are
allowed to contribute 0 rows. If \code{FALSE} (default), such groups are
forced to contribute 1 row.}

\item{method}{Rounding method used when \verb{0 < size < 1}.
One of \code{"round"}, \code{"floor"}, or \code{"ceiling"}. Ignored when \code{size >= 1}.}

\item{verbose}{Logical; if \code{TRUE}, print a sampling summary table.
Default \code{TRUE}.}

\item{seed}{Optional integer; if supplied, sets the RNG seed for
reproducibility. If \code{NULL}, no seed is set. (Default \code{123}.)}
}
\value{
A data.table consisting of the sampled rows. An attribute
\code{"group"} is attached describing per-group population size, target
sample size, and realized proportion.
}
\description{
\ifelse{html}{\href{https://lifecycle.r-lib.org/articles/stages.html#experimental}{\figure{lifecycle-experimental.svg}{options: alt='[Experimental]'}}}{\strong{[Experimental]}}

Perform stratified sampling on a data.table, drawing a specified number
of rows \strong{within each group}.
}
\details{
Let \emph{n\if{html}{\out{<sub>}}g\if{html}{\out{</sub>}}} be the size of group \emph{g}.
\itemize{
\item If \verb{0 < size < 1}, the target sample size per group is computed as
\verb{method(}\emph{n\if{html}{\out{<sub>}}g\if{html}{\out{</sub>}}}\verb{ * size)} where \code{method} is one of \code{"round"}, \code{"floor"},
or \code{"ceiling"}.
\item If \code{size >= 1}, the target sample size per group is the same constant
\code{size} for all groups.
\item If \code{contain0 = FALSE} (default), any group whose target becomes 0 is
bumped up to 1 so that \strong{every group contributes at least one row}.
\item Sampling is done independently within each group using
\code{base::sample.int()} with \code{replace} as specified.
}

The result carries an attribute \code{"group"} (a data.table of
group counts and final per-group sample sizes) for auditing.
}
\examples{
\donttest{
dt <- data.table::as.data.table(iris)

# 10\% per-group sample (rounded), with replacement
stratified_sampling(dt, group_var = .(Species), size = 0.1, method = "round")

# Fixed 5 rows per group (same count for all groups)
stratified_sampling(dt, group_var = .(Species), size = 5, replace = FALSE)

# Allow groups to contribute zero when proportion rounds to 0
stratified_sampling(dt, group_var = .(Species), size = 0.01,
                    method = "floor", contain0 = TRUE)

# Reproducible result with a fixed seed
stratified_sampling(dt, group_var = .(Species), size = 0.2, seed = 42)
}

}
