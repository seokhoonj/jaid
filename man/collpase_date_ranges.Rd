% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/date.R
\name{collpase_date_ranges}
\alias{collpase_date_ranges}
\title{Collapse overlapping (or near-adjacent) date ranges by ID}
\usage{
collpase_date_ranges(
  df,
  id_var,
  merge_var,
  from_var,
  to_var,
  interval = 0,
  collapse = "|"
)
}
\arguments{
\item{df}{A \code{data.table} containing date ranges.}

\item{id_var}{One or more ID columns (bare names). Ranges are merged within each unique ID.}

\item{merge_var}{Optional columns (bare names) whose values will be collapsed
over the merged range (see \code{collapse}).}

\item{from_var}{Start-date column (bare name). Must be \code{Date} (days).}

\item{to_var}{End-date column (bare name). Must be \code{Date} (days, inclusive).}

\item{interval}{Non-negative number of \strong{days} allowed between the previous
end date and the next start date to still be merged. For example,
\code{interval = 0} merges touching ranges (end + 1 day == next start).}

\item{collapse}{Character delimiter used to combine \code{merge_var} values.
Defaults to \code{"|"}. Duplicates and \code{NA} are removed before collapsing.}
}
\value{
A \code{data.table} with merged, non-overlapping date ranges. The output
contains the ID columns, any \code{merge_var} columns (collapsed), the original
date columns (\code{from_var}, \code{to_var}), and a \code{stay} column giving the number
of inclusive days in each merged range.
}
\description{
Merges multiple date ranges that either overlap or are within a user-defined
gap (\code{interval} days) \strong{within each ID group}. Optionally collapses one or
more columns (\code{merge_var}) by concatenating unique values.
}
\details{
\itemize{
\item Input is internally sorted by \code{id_var}, \code{from_var}, \code{to_var}.
\item Dates are treated as \strong{inclusive}; adjacency is tested against \code{to + 1}.
\item \code{interval} must be \verb{>= 0} and is interpreted in whole days.
\item Requires \code{data.table}. The merging index is computed in C for speed.
}
}
\examples{
\dontrun{
id <- c("A","A","B")
work <- c("cleansing","analysis","cleansing")
sdate <- as.Date(c("2022-03-01","2022-03-05","2022-03-08"))
edate <- as.Date(c("2022-03-06","2022-03-09","2022-03-10"))
dt <- data.table::data.table(id = id, work = work, sdate = sdate, edate = edate)

# Merge overlapping or touching ranges (interval = 0)
collapse_date_ranges(dt, id, work, sdate, edate, interval = 0)

# Allow gaps up to 2 days to merge, and use comma to collapse labels
collapse_date_ranges(dt, id, work, sdate, edate, interval = 2, collapse = ", ")
}

}
